
generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id               String            @id @default(cuid())
  email            String            @unique
  name             String?
  password         String?
  role             Role              @default(USER)
  emailVerified    DateTime?
  image            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  festivalRequests FestivalRequest[]
  festivals        Festival[]
  tickets          Ticket[]

  @@map("users")
}

model Festival {
  id                 String         @id @default(cuid())
  name               String
  slug               String         @unique
  description        String
  categoryId         String
  startDate          DateTime
  endDate            DateTime
  startTime          String
  endTime            String
  venueName          String
  venueAddress       String
  city               String
  state              String
  zipCode            String?
  country            String         @default("United States")
  venueType          VenueType
  price              Float
  currency           String         @default("USD")
  capacity           Int
  expectedAttendance String
  isFree             Boolean        @default(false)
  ageRestriction     String?
  isAccessible       Boolean        @default(false)
  hasParking         Boolean        @default(false)
  hasFoodVendors     Boolean        @default(false)
  servesAlcohol      Boolean        @default(false)
  images             String[]
  websiteUrl         String?
  socialMediaLinks   String?
  status             FestivalStatus @default(DRAFT)
  isPublished        Boolean        @default(false)
  publishedAt        DateTime?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  organizerId        String
  category           Category       @relation(fields: [categoryId], references: [id])
  organizer          User           @relation(fields: [organizerId], references: [id])
  tickets            Ticket[]

  @@map("festivals")
}

model FestivalRequest {
  id                      String        @id @default(cuid())
  organizerName           String
  organizerEmail          String
  organizerPhone          String
  organizationName        String
  organizationWebsite     String?
  organizationDescription String
  festivalName            String
  festivalDescription     String
  category                String
  startDate               DateTime
  endDate                 DateTime
  startTime               String
  endTime                 String
  venueName               String
  venueAddress            String
  city                    String
  state                   String
  zipCode                 String?
  country                 String        @default("United States")
  venueType               String
  expectedAttendance      String
  ticketPrice             Float?
  isFree                  Boolean       @default(false)
  ageRestriction          String?
  isAccessible            Boolean       @default(false)
  hasParking              Boolean       @default(false)
  hasFoodVendors          Boolean       @default(false)
  servesAlcohol           Boolean       @default(false)
  websiteUrl              String?
  socialMediaLinks        String?
  previousEvents          String?
  marketingPlan           String?
  specialRequirements     String?
  insuranceInfo           String?
  hasPermits              Boolean       @default(false)
  emergencyPlan           String?
  status                  RequestStatus @default(PENDING)
  reviewNotes             String?
  rejectionReason         String?
  reviewedAt              DateTime?
  submittedAt             DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  reviewerId              String?
  reviewer                User?         @relation(fields: [reviewerId], references: [id])

  @@map("festival_requests")
}

model Category {
  id          String     @id @default(cuid())
  name        String     @unique
  slug        String     @unique
  description String?
  color       String?
  icon        String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  festivals   Festival[]

  @@map("categories")
}

model Ticket {
  id          String       @id @default(cuid())
  ticketId    String       @unique
  qrCode      String       @unique
  buyerName   String
  buyerEmail  String
  buyerPhone  String?
  price       Float
  currency    String       @default("USD")
  status      TicketStatus @default(ACTIVE)
  qrCodeData  String
  isUsed      Boolean      @default(false)
  usedAt      DateTime?
  purchasedAt DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  festivalId  String
  buyerId     String?
  buyer       User?        @relation(fields: [buyerId], references: [id])
  festival    Festival     @relation(fields: [festivalId], references: [id])

  @@map("tickets")
}

model EmailLog {
  id        String      @id @default(cuid())
  to        String
  from      String
  subject   String
  template  String?
  status    EmailStatus @default(PENDING)
  error     String?
  sentAt    DateTime?
  createdAt DateTime    @default(now())

  @@map("email_logs")
}

enum Role {
  USER
  ADMIN
  ORGANIZER
}

enum FestivalStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  COMPLETED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

enum VenueType {
  OUTDOOR
  INDOOR
  MIXED
  VIRTUAL
  HYBRID
}

enum TicketStatus {
  ACTIVE
  CANCELLED
  REFUNDED
  EXPIRED
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
  BOUNCED
}
